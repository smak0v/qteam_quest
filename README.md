# Korobka Games Project

## Установка и запуск сервиса
Для локальустановки и запуска сервиса нужно выполнить дальнейшие шаги.

### Подготовка базы данных
1. Установить ```PostgreSQL```.

2. Открыть консоль или командную строку, войти в ```PostgreSQL``` под пользователем ```postgres```.

3. Создать базу данных ```korobka_games```:
    ```
    CREATE DATABASE korobka_games;
    ```

4. Создать пользователя ```korobka_games_user``` с паролем ```korobka_games_password```:
    ```
    CREATE USER korobka_games_user WITH PASSWORD 'korobka_games_password';
    ```

5. Дать созданому пользователю все права и разрешения на взаимодействие с базой данных ```korobka_games```:
    ```
    GRANT ALL PRIVILEGES ON DATABASE korobka_games TO korobka_games_user;
    ```

### Подготовка окружения
1. Установить ```Python 3.7```.

2. Установить модуль для создания виртуального окружения выполнив следующую команду в терминале или командной стркое:
    ```
    $ pip install virtualenv
    ```

3. Перейти в директорию с проектом.

4. Создать виртуальное окружение:
    ```
    $ virtualenv venv
    ```

5. Активировать виртуальное окружение:
    - для пользователей Unix OS / Mac OS:
        ```
        $ source venv/bin/activate
        ```
    - для пользователей Windows OS:
        ```
        $ cd venv
        $ cd Scripts
        $ activate
        $ cd ..
        $ cd ..
        ```
6. Установить зависимости для проекта:
    ```
    (venv)$ pip install -r requirements.txt
    ```
7. Установить ```Redis``` с помощью следующей команды в терминале:
    ```
    $ sudo apt install redis
    ```
8. Проверить корректность установки ```Redis``` с помощью следующей команды в терминале:
    ```
   $ redis-cli ping
    ```
   В ответ в терминале должно появится сообщение ```PONG```.

### Подготовка и запуск сервиса
1. Выполнить миграции в базу данных:
    ```
    (venv)$ python manage.py migrate
    ```
2. Запустить сервис:
    ```
    (venv)$ python manage.py runserver
    ```
3. Открыть второе окно терминала, активировать виртуальное окружение проекта в нем и выполнить следующую команду:
    ```
   (venv)$ celery -A korobka_games worker -l info
   ```
4. Открыть третье окно терминала, активировать виртуальное окружение проекта в нем и выполнить следующую команду:
    ```
   (venv)$ celery -A korobka_games beat -l info
    ``` 
5. Для заполнения базы данных тестовым набором данных выполнить команду в терминале (предварительно изменив ENDPOINT
переменную):
    ```
    (venv)$ python scripts/1_fill_db.py
    ```
6. Для более детального заполнения тестового набора данных (картинки и т.п.), выполнить скрипты из папки ```/users/management/commands```:
    ```
    (venv)$ python manage.py add_images
    (venv)$ python manage.py add_metro_stations
    ```
7. Для удаления всей информации с базы данных (кроме суперпользователей) вуполнить команду в терминале (предварительно 
изменив ENDPOINT переменную):
    ```
    (venv)$ python scripts/0_clear_db.py
    ```
8. Перейти в браузере по адресу ```http://127.0.0.1:8000```.